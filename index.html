<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Bebidas - Admin Anthony</title>
    <style>
        body {font-family: Arial, sans-serif; background:#121212; color:#fff; margin:0; padding:20px;}
        .container {max-width:900px; margin:0 auto; background:#1a1a1a; padding:30px; border-radius:15px; box-shadow:0 0 20px rgba(0,255,255,0.2);}
        h1 {color:#00ffff; text-align:center;}
        input, button {padding:12px; margin:8px; font-size:16px; border-radius:8px; border:none;}
        input[type="text"], input[type="password"] {background:#333; color:white; width:280px;}
        button {background:#00bfff; color:white; cursor:pointer;}
        button:hover {background:#0099cc;}
        .btn-verde {background:#28a745;}
        .btn-rojo {background:#dc3545;}
        .btn-amarillo {background:#ffc107; color:black;}
        .btn-borrar {background:#8B0000; font-size:12px; padding:6px 10px;}
        .hidden {display:none;}
        #contador {font-size:70px; color:#00ff99; font-weight:bold;}
        .lista-user {background:#222; padding:15px; margin:10px 0; border-radius:10px; border-left:5px solid #00ffff; position:relative;}
        .admin-only {color:#ff4444; font-size:14px; font-weight:bold;}
        table {width:100%; border-collapse:collapse; margin-top:10px;}
        th, td {padding:10px; border-bottom:1px solid #444;}
        th {background:#333;}
    </style>
</head>
<body>
<div class="container">
    <h1>Control de Bebidas - Fiesta 2025</h1>

    <!-- Login -->
    <div id="login">
        <h2>Iniciar Sesión</h2>
        <input type="text" id="userLogin" placeholder="Usuario" autocomplete="off"><br>
        <input type="password" id="passLogin" placeholder="Contraseña"><br>
        <button onclick="login()">Entrar</button>
        <button onclick="showRegister()">Nuevo Usuario</button>
        <p style="font-size:12px;color:#666;">
            Admin: Anthonoy<br>
            Contraseña: .Asking882465
        </p>
    </div>

    <!-- Registro -->
    <div id="register" class="hidden">
        <h2>Crear Usuario</h2>
        <input type="text" id="newUser" placeholder="Usuario"><br>
        <input type="password" id="newPass1" placeholder="Contraseña"><br>
        <input type="password" id="newPass2" placeholder="Repetir"><br>
        <button class="btn-verde" onclick="registerUser()">Crear</button>
        <button onclick="backToLogin()">Cancelar</button>
    </div>

    <!-- Panel Usuario -->
    <div id="panel" class="hidden">
        <h2>Bienvenido, <span id="welcomeName"></span>! 
            <span id="adminTag" class="admin-only"></span>
        </h2>
        <h3>Total: <span id="contador">0</span></h3>
        <button class="btn-verde" onclick="addMode()">+ Agregar</button>
        <button class="btn-rojo" onclick="consumeMode()">- Consumir</button>
        <button onclick="logout()">Salir</button>

        <div id="addSection" class="hidden" style="margin-top:20px;">
            <h3>Agregar Bebida</h3>
            <button class="btn-amarillo" onclick="addBeer()">Cerveza</button>
            <button onclick="showOther()">Otra</button>
            <div id="otherForm" class="hidden">
                <input type="text" id="otherName" placeholder="Nombre (ej: fernet)"><br>
                <input type="number" id="otherQty" value="1" min="1"><br>
                <button class="btn-verde" onclick="addOther()">Agregar</button>
            </div>
        </div>

        <div id="consumeSection" class="hidden" style="margin-top:20px;">
            <h3>Consumir</h3>
            <div id="consumeList"></div>
        </div>
    </div>

    <!-- Lista General -->
    <div style="margin-top:40px;">
        <h2>Lista General</h2>
        <div id="generalList"></div>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('bebidasDB')) || {};
    let currentUser = null;
    let isAdmin = false;

    const ADMIN_USER = 'anthony';  // clave normalizada
    const ADMIN_PASS = '.Asking882465';

    // Crear administrador si no existe
    if (!users[ADMIN_USER]) {
        users[ADMIN_USER] = {
            name: 'Anthony',
            pass: ADMIN_PASS,
            drinks: {},
            isAdmin: true
        };
        localStorage.setItem('bebidasDB', JSON.stringify(users));
    }

    function norm(name) { return name.trim().toLowerCase tradem(); }

    function login() {
        const u = document.getElementById('userLogin').value.trim();
        const p = document.getElementById('passLogin').value;
        if (!u || !p) return alert('Completa usuario y contraseña');
        const key = norm(u);
        if (!users[key]) return alert('Usuario no encontrado');
        if (users[key].pass !== p) return alert('Contraseña incorrecta');

        currentUser = key;
        isAdmin = (key === ADMIN_USER);
        document.getElementById('welcomeName').textContent = users[key].name;
        document.getElementById('adminTag').textContent = isAdmin ? ' (ADMINISTRADOR)' : '';
        document.getElementById('login').classList.add('hidden');
        document.getElementById('panel').classList.remove('hidden');
        updateCounter();
        updateConsumeList();
        updateGeneral();
    }

    function showRegister() {
        document.getElementById('login').classList.add('hidden');
        document.getElementById('register').classList.remove('hidden');
    }

    function backToLogin() {
        document.getElementById('register').classList.add('hidden');
        document.getElementById('login').classList.remove('hidden');
    }

    function registerUser() {
        const u = document.getElementById('newUser').value.trim();
        const p1 = document.getElementById('newPass1').value;
        const p2 = document.getElementById('newPass2').value;
        if (!u || !p1 || p1 !== p2) return alert('Completa todo y las contraseñas deben coincidir');
        const key = norm(u);
        if (users[key]) return alert('Usuario ya existe');
        if (key === ADMIN_USER) return alert('Este nombre está reservado');
        users[key] = { name: u, pass: p1, drinks: {}, isAdmin: false };
        localStorage.setItem('bebidasDB', JSON.stringify(users));
        alert(`¡Usuario "${u}" creado con éxito!`);
        backToLogin();
        updateGeneral();
    }

    // --- Bebidas (igual que antes) ---
    function addMode() { document.getElementById('addSection').classList.remove('hidden'); document.getElementById('consumeSection').classList.add('hidden'); }
    function consumeMode() { document.getElementById('consumeSection').classList.remove('hidden'); document.getElementById('addSection').classList.add('hidden'); updateConsumeList(); }

    function addBeer() {
        const q = prompt('¿Cuántas cervezas?', '6');
        if (q && !isNaN(q) && q > 0) addDrink('cerveza', parseInt(q));
    }
    function showOther() { document.getElementById('otherForm').classList.remove('hidden'); }
    function addOther() {
        const name = document.getElementById('otherName').value.trim().toLowerCase();
        const q = parseInt(document.getElementById('otherQty').value);
        if (name && q > 0) {
            addDrink(name, q);
            document.getElementById('otherName').value = '';
            document.getElementById('otherForm').classList.add('hidden');
        } else alert('Completa bien');
    }
    function addDrink(type, qty) {
        if (!users[currentUser].drinks[type]) users[currentUser].drinks[type] = 0;
        users[currentUser].drinks[type] += qty;
        saveAll();
    }

    function updateCounter() {
        const total = Object.values(users[currentUser].drinks).reduce((a, b) => a + b, 0);
        document.getElementById('contador').textContent = total;
    }

    function updateConsumeList() {
        const div = document.getElementById('consumeList');
        div.innerHTML = '';
        const drinks = users[currentUser].drinks;
        if (Object.keys(drinks).length === 0) return div.innerHTML = '<p>Sin bebidas.</p>';
        for (let [type, qty] of Object.entries(drinks)) {
            if (qty > 0) {
                const pretty = type.charAt(0).toUpperCase() + type.slice(1);
                div.innerHTML += `<div style="background:#333;padding:15px;margin:10px 0;border-radius:8px;">
                    ${pretty}: ${qty} <input type="number" id="q_${type}" min="1" max="${qty}" value="1" style="width:60px;">
                    <button class="btn-rojo" onclick="consume('${type}')">Consumir</button>
                </div>`;
            }
        }
    }

    function consume(type) {
        const q = parseInt(document.getElementById('q_' + type).value);
        if (q > 0 && users[currentUser].drinks[type] >= q) {
            users[currentUser].drinks[type] -= q;
            if (users[currentUser].drinks[type] <= 0) delete users[currentUser].drinks[type];
            saveAll();
        }
    }

    function saveAll() {
        localStorage.setItem('bebidasDB', JSON.stringify(users));
        updateCounter();
        updateConsumeList();
        updateGeneral();
    }

    function logout() {
        if (confirm('¿Cerrar sesión?')) {
            currentUser = null; isAdmin = false;
            document.getElementById('panel').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
            document.getElementById('addSection').classList.add('hidden');
            document.getElementById('consumeSection').classList.add('hidden');
        }
    }

    // --- BORRAR USUARIO (solo Anthonoy) ---
    window.deleteUser = function(userKey) {
        if (!isAdmin) return;
        if (userKey === ADMIN_USER) return alert('No puedes borrarte a ti mismo');
        const userName = users[userKey].name;
        if (confirm(`¿ELIMINAR definitivamente a "${userName}" y todas sus bebidas?`)) {
            delete users[userKey];
            saveAll();
            alert(`Usuario "${userName}" eliminado`);
        }
    }

    // --- Lista General ---
    function updateGeneral() {
        const div = document.getElementById('generalList');
        div.innerHTML = '';
        if (Object.keys(users).length === 0) {
            div.innerHTML = '<p>Sin usuarios.</p>';
            return;
        }
        for (let key in users) {
            const u = users[key];
            const total = Object.values(u.drinks).reduce((a, b) => a + b, 0);
            let html = `<div class="lista-user">
                <strong>${u.name}</strong> ${key === ADMIN_USER ? ' (ADMINISTRADOR)' : ''}: ${total} bebidas`;
            if (isAdmin && key !== ADMIN_USER) {
                html += ` <button class="btn-borrar" onclick="deleteUser('${key}')">Borrar</button>`;
            }
            html += `<table><tr><th>Bebida</th><th>Cant</th></tr>`;
            for (let [d, c] of Object.entries(u.drinks)) {
                const pretty = d.charAt(0).toUpperCase() + d.slice(1);
                html += `<tr><td>${pretty}</td><td>${c}</td></tr>`;
            }
            html += '</table></div>';
            div.innerHTML += html;
        }
    }

    updateGeneral();
</script>
</body>
</html>


